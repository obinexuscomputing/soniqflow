<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoniqWave Demo</title>
    <script src="../dist/index.umd.js" defer></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            console.log("SoniqWave library loaded:", SoniqWave);

            let audioContext;
            const initializeAudioContext = async () => {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                    console.log('AudioContext resumed.');
                }
                return audioContext;
            };

            const initializeSoniqWave = async () => {
                try {
                    // Initialize SoniqWave with a seed
                    const seed = Math.floor(Math.random() * 1000);
                    const soniqWave = new SoniqWave.SoniqSound(seed);
                    const playbackManager = new SoniqWave.AudioPlaybackManager(bubbles = true);

                    // Get canvas element for visualization
                    const canvas = document.getElementById("visualization");
                    if (!canvas || !(canvas instanceof HTMLCanvasElement)) {
                        throw new Error("Canvas element not found or invalid.");
                    }

                    // Attach user gesture listener
                    document.getElementById("start-demo").addEventListener('click', async () => {
                        await initializeAudioContext();

                        // Setup parameters
                        const baseFrequency = 440; // A4 in Hz
                        const harmonics = [1, 2, 3, 4, 5]; // Multiples of the base frequency
                        const amplitudes = [1.5, 1.2, 1.0, 1.8, 1.6]; // Increased amplitudes for louder sound

                        // Generate harmonic wave from background noise
                        const data = await soniqWave.generateHarmonicWave({
                            baseFrequency,
                            harmonics,
                            amplitudes,
                            canvas, // Pass canvas to generateHarmonicWave
                        });

                        playbackManager.play(data, true); // Use playback manager to play in real-time

                        console.log("Harmonic wave generated and played!");
                    });

                    console.log("Click the button to start AudioContext and demo.");
                } catch (error) {
                    console.error("Error initializing SoniqWave:", error);
                }
            };

            initializeSoniqWave();
        });
    </script>
</head>
<body>
    <h1>SoniqWave Demo</h1>
    <button id="start-demo">Start Harmonic Wave</button>
    <p>Click the button above to resume AudioContext and start the demo.</p>
    <canvas id="visualization" width="800" height="600" style="border: 1px solid black;"></canvas>
</body>
</html>